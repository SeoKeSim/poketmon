<head>
    <link rel="stylesheet" href="/css/header.css">
</head>
<header class="header">
    <div class="header-container">
        <div class="header-left">
            <a href="/" class="logo-link">
                <img src="/image/pokemon_logo.png" alt="포켓몬 로고" class="header-logo">
            </a>
        </div>

        <nav class="header-nav">
            {{#loginUser}}
                <!-- 로그인된 상태 -->
                <div class="nav-menu">
                    <a href="/favorites" class="nav-link favorites-link">
                        <span class="favorites-icon">⭐</span>
                        <span class="favorites-text">내 즐겨찾기</span>
                        <span class="favorites-count-badge" id="headerFavoriteCount"></span>
                    </a>
                </div>

                <div class="user-info">
                    <span class="welcome-text">{{userName}}님 환영합니다!</span>
                    <form action="/users/logout" method="post" class="logout-form">
                        <button type="submit" class="logout-btn">로그아웃</button>
                    </form>
                </div>
            {{/loginUser}}

            {{^loginUser}}
                <!-- 로그인되지 않은 상태 -->
                <div class="auth-buttons">
                    <a href="/users/login" class="auth-btn login-btn">로그인</a>
                    <a href="/users/register" class="auth-btn register-btn">회원가입</a>
                </div>
            {{/loginUser}}
        </nav>
    </div>
</header>

<script>
    // 즐겨찾기 개수 업데이트 (로그인된 경우에만)
    document.addEventListener('DOMContentLoaded', function() {
        const favoriteCountBadge = document.getElementById('headerFavoriteCount');
        if (favoriteCountBadge) {
            updateHeaderFavoriteCount();
        }
    });

    async function updateHeaderFavoriteCount() {
        try {
            const response = await fetch('/api/favorites/count');
            const result = await response.json();

            if (result.success && result.data > 0) {
                const badge = document.getElementById('headerFavoriteCount');
                if (badge) {
                    badge.textContent = result.data;
                    badge.style.display = 'inline-block';
                }
            }
        } catch (error) {
            console.log('즐겨찾기 개수 조회 실패:', error);
        }
    }

    // 전역 함수로 다른 페이지에서도 사용할 수 있도록
    window.updateHeaderFavoriteCount = updateHeaderFavoriteCount;
</script>